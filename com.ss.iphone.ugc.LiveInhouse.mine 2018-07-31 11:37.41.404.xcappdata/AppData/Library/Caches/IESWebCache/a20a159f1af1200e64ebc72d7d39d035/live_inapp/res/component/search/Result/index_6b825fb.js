define("component/search/Result/index.vue",function(e,t,a){function s(e){return e&&e.__esModule?e:{"default":e}}function o(){return o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e},o.apply(this,arguments)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=s(e("node_modules/axios/index")),n=s(e("node_modules/object-path/index")),l=s(e("component/common/FollowButton/index.vue")),i=s(e("component/util/huoshan")),u=s(e("page/search/store")),d={data:function(){return{store:u.default,reloading:!1,source:null,reloadFailed:!1,loadingMore:!1,loadMoreFailed:!1,offset:0,count:20,hasMore:!0,results:[]}},created:function(){var e=this;this.reload(),i.default.on("H5_userStatusChange",function(t){if(!t)return!1;switch(t.args.follow_status||i.default.sendAppLogV3("unfollow",{_staging_flag:"1",search_content:u.default.state.keywords,user_id:t.args.user_id,event_belong:"relation",event_page:"search_result",event_module:"recommend",action_type:u.default.state.user_action}),t.type){case"follow":e.results=e.results.map(function(e){return 1==e.type&&e.user.id==t.args.user_id&&(e.user.followStatus=t.args.follow_status),e})}})},components:{FollowButton:l.default},beforeRouteUpdate:function(e,t,a){this.reload(),a()},methods:{onVisitSearch:function(e){if(1==e.type){var t=e.user.id;i.default.sendAppLog("other_profile",u.default.state.fromLabel,t,"",{search_keyword:u.default.state.keywords}),i.default.sendAppLogV3("enter_profile",{event_belong:"relation",event_page:"search_result",event_module:"recommend",event_type:"click",search_content:u.default.state.keywords,action_type:u.default.state.user_action,user_id:t,_staging_flag:"1"}),i.default.openProfile(t,u.default.state.fromLabel,u.default.state.page_source)}else if(2==e.type){var t=e.hash_tag.id_string;i.default.openHashtag(t,"search_result",u.default.state.user_action,"recommend")}},onFollowUser:function(e){var t=this;i.default.getAppVersion().then(function(a){272>a?t.onOldFollowUser(e):i.default.followUser(e,u.default.state.fromLabel).then(function(){i.default.sendAppLog("follow",u.default.state.fromLabel,e,"",{search_keyword:u.default.state.keywords}),i.default.sendAppLogV3("follow",{_staging_flag:"1",search_content:u.default.state.keywords,user_id:e.toString(),event_belong:"relation",event_module:"recommend",event_page:"search_result",action_type:u.default.state.user_action})}).catch(function(){})}).catch(function(){})},onOldFollowUser:function(e){var t=this;r.default.post("/hotsoon/user/".concat(e,"/_follow/"),u.default.state.apiParams,{timeout:3e3}).then(function(e){return e.data}).then(function(a){if(20003==a.status_code)return i.default.openLogin(),!1;if(a.status_code){var s=a.data&&a.data.prompts?a.data.prompts:"关注失败，请稍后重试";return i.default.showToast(s),!1}t.results=t.results.map(function(t){return t.user.id===e&&(t.user.followStatus=a.data.follow_status),t}),i.default.syncFollowStatus(e,a.data.follow_status),i.default.sendAppLog("follow",u.default.state.fromLabel,e,"",{search_keyword:u.default.state.keywords}),i.default.sendAppLogV3("follow",{_staging_flag:"1",search_content:u.default.state.keywords,user_id:e.toString(),event_belong:"relation",event_module:"recommend",event_page:"search_result",action_type:u.default.state.user_action})}).catch(function(){i.default.showToast("关注失败，请稍后重试")})},onUnFollowUser:function(e){i.default.sendAppLog("cancel_follow",u.default.state.fromLabel,e),i.default.sendAppLogV3("cancel_follow",{follow_source:u.default.state.fromLabel,user_id:e.toString()}),i.default.sendAppLogV3("unfollow_popup",{follow_source:u.default.state.fromLabel,user_id:e.toString()}),i.default.unfollowUser(e,u.default.state.fromLabel)},onVisitVideo:function(e){i.default.sendAppLog("play_video",u.default.state.fromLabel,"","",{search_keyword:u.default.state.keywords,vid:e,value:e,source:u.default.state.fromLabel}),i.default.sendAppLogV3("play_video",{search_keyword:u.default.state.keywords,vid:e,value:e,source:u.default.state.fromLabel}),i.default.openVideo(e,u.default.state.fromLabel)},fetch:function(){var e=r.default.CancelToken,t=this,a="/hotsoon/search/general_search/";return u.default.state.appVersion>=330?(document.getElementsByTagName("body")[0].addEventListener("touchmove",t.handler),i.default.fetch("https://api.huoshan.com"+a,"GET",{q:u.default.state.keywords||"",offset:this.offset,count:this.count,from_label:u.default.state.fromLabel,user_action:u.default.state.user_action}).then(function(e){var a=e.raw;if(document.getElementsByTagName("body")[0].removeEventListener("touchmove",t.handler),1==e.code&&0==a.status_code)return t.formatData(a);throw new Error(a.data.message||a.data.prompt)})):r.default.get(a,{cancelToken:new e(function(e){t.source=e}),params:o({},u.default.state.apiParams,{q:u.default.state.keywords||"",offset:this.offset,count:this.count,from_label:u.default.state.fromLabel,user_action:u.default.state.user_action}),timeout:5e3}).then(function(e){var a=e.data;if(0!=a.status_code)throw new Error(a.data.message||a.data.prompt);return t.formatData(a)})},reload:function(){var e=this;u.default.state.keywords&&(i.default.sendAppLogV3("search_result_show",{event_belong:"function",event_page:"search_result",event_module:"recommend",event_type:"show",search_content:u.default.state.keywords,action_type:u.default.state.user_action}),this.reloading=!0,this.source&&(this.source(),this.source=null),this.reloadFailed=!1,this.offset=0,this.results=[],this.fetch().then(function(t){e.reloading=!1,e.offset+=e.count,t.hasMore&&t.results.length<=0?e.hasMore=!1:(e.hasMore=t.hasMore,e.results=t.results)}).catch(function(){e.reloading||(e.reloadFailed=!0),e.reloading=!1}))},loadMore:function(){var e=this;this.loadingMore||!this.hasMore||this.results.length<=0||(this.loadingMore=!0,this.loadMoreFailed=!1,this.fetch().then(function(t){e.loadingMore=!1,e.offset+=e.count,t.hasMore&&t.results.length<=0?e.hasMore=!1:(e.hasMore=t.hasMore,e.results=e.results.concat(t.results))}).catch(function(){e.loadingMore=!1,e.loadMoreFailed=!0}),i.default.sendAppLogV3("search_loadmore",{event_type:"click",event_belong:"video",event_page:"search_result",event_module:"recommend",keywords:u.default.state.keywords}))},highlight:function(e){var t=new RegExp("".concat(u.default.state.keywords,"+"),"gi");return e.replace(t,function(e){return'<span class="highlight">'.concat(e,"</span>")})},formatData:function(e){var t=this;return{hasMore:e.extra.has_more,results:(e.data||[]).map(function(e){return 1==e.type?{user:{id:n.default.get(e,"user.id_str"),nickname:t.highlight(n.default.get(e,"user.highlight_nickname")||n.default.get(e,"user.nickname")),signature:n.default.get(e,"user.highlight_signature")||n.default.get(e,"user.signature"),total_fans_count:n.default.get(e,"user.total_fans_count")||0,verified:n.default.get(e,"user.verified"),hotsoonVerified:n.default.get(e,"user.hotsoon_verified"),avatar:n.default.get(e,"user.avatar_thumb.url_list.0"),followStatus:n.default.get(e,"user.follow_status"),short_id:n.default.get(e,"user.short_id")},items:(e.items||[]).map(function(e){return{id:n.default.get(e,"id_str"),cover:n.default.get(e,"video.cover.url_list.0")}}),type:1}:2==e.type?{hash_tag:{id_string:n.default.get(e,"hash_tag.id_string"),title:t.highlight(n.default.get(e,"hash_tag.title")),video_cnt:t.formatNum(n.default.get(e,"hash_tag.video_cnt"))},type:2}:{}})}},handler:function(e){e.preventDefault()},formatNum:function(e){var e=parseInt(e,10),t=e.toString();return isNaN(e)?e:t.length<5?e:5===t.length?(e/1e4).toFixed(1)+"万":t.length>=6?(e/1e4).toFixed(0)+"万":void 0}}};t.default=d;var c;c=t&&t.__esModule&&t.default?t.default:a.exports,c.render=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"result-wrapper"},[e.reloading?a("div",{staticClass:"reloading-container"},[e._m(0)]):e.reloadFailed?a("div",{staticClass:"retry-container",on:{click:e.reload}},[a("span",{staticClass:"tip-icon"}),e._v(" "),a("span",{staticClass:"tip-fail"},[e._v("加载失败")]),e._v(" "),a("span",{staticClass:"tip-retry"},[e._v("点击屏幕重试")])]):e.results.length<=0&&!this.hasMore?a("div",{staticClass:"no-result-container"},[a("span",{staticClass:"tip-text"},[e._v("居然木有结果，换个姿势再来一次吧")])]):e._e(),e._v(" "),a("ul",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:e.loadMore.bind(this),expression:"loadMore.bind(this)"}],staticClass:"result-list"},[e._l(e.results,function(t,s){return a("li",{key:s,staticClass:"result-item",on:{click:function(){e.onVisitSearch(t)}}},[1==t.type?a("div",{staticClass:"user-container"},[a("div",{staticClass:"user-wrap clearfix"},[a("div",{staticClass:"head-wrap"},[a("img",{directives:[{name:"lazy",rawName:"v-lazy",value:t.user.avatar,expression:"result.user.avatar"}],attrs:{alt:""}}),e._v(" "),a("div",{"class":{"verified-hotsoon-user":t.user.hotsoonVerified,"verified-weibo-user":t.user.verified}})]),e._v(" "),a("div",{staticClass:"profile-info"},[a("div",{staticClass:"nickname","class":{highlight:t.user.short_id==e.store.state.keywords},domProps:{innerHTML:e._s(t.user.nickname)}}),e._v(" "),a("div",{staticClass:"fan-info"},[e._v("粉丝数："+e._s(e.formatNum(t.user.total_fans_count)))]),e._v(" "),a("div",{staticClass:"signature"},[e._v(e._s(t.user.signature))])]),e._v(" "),t.user.id!==e.store.state.current_uid?a("div",{staticClass:"follow-btn-wrap"},[a("FollowButton",{attrs:{followStatus:t.user.followStatus},on:{follow:function(){e.onFollowUser(t.user.id)},unfollow:function(){e.onUnFollowUser(t.user.id)}}})],1):e._e()]),e._v(" "),t.items&&t.items.length>0?a("div",{staticClass:"items-wrap"},[a("div",{staticClass:"items clearfix"},e._l(t.items,function(t){return a("div",{key:t.id,staticClass:"item-box"},[a("a",{directives:[{name:"lazy",rawName:"v-lazy:background-image",value:t.cover,expression:"item.cover",arg:"background-image"}],staticClass:"item item-video",attrs:{href:"javascript:;","data-item-id":t.id},on:{click:function(a){a.stopPropagation(),e.onVisitVideo(t.id)}}})])}))]):e._e()]):2==t.type?a("div",{staticClass:"hash-container"},[a("div",{staticClass:"hash-wrap"},[a("img",{staticClass:"icon-wrap",attrs:{src:"//hotsoon.snssdk.com/falcon/live_inapp/res/static/image/search/hash_icon_727b5ed.png",alt:""}}),e._v(" "),a("div",{staticClass:"hash-info",domProps:{innerHTML:e._s(t.hash_tag.title)}}),e._v(" "),a("div",{staticClass:"hash-count"},[e._v("\n                        "+e._s(t.hash_tag.video_cnt)+"个视频\n                    ")])])]):e._e(),e._v(" "),a("div",{staticClass:"hasborder"})])}),e._v(" "),a("li",{staticClass:"list-footer"},[e.loadingMore?a("a",{attrs:{href:"javascript:;"}},[a("span",{staticClass:"loading-text"},[e._v("加载更多")]),e._v(" "),a("i",{staticClass:"loading-spinner spinning"})]):e.loadMoreFailed?a("a",{attrs:{href:"javascript:;"}},[a("span",{staticClass:"loading-text"},[e._v("加载更多失败")])]):!e.hasMore&&e.results.length>0?a("a",{attrs:{href:"javascript:;"}},[a("span",{staticClass:"loading-text"},[e._v("没有更多了~")])]):!e.hasMore||e.loadingMore||e.reloading?e._e():a("a",{attrs:{href:"javascript:;"},on:{click:e.loadMore}},[a("span",{staticClass:"loading-text"},[e._v("点击加载更多~")])])])],2)])},c.staticRenderFns=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a",{attrs:{href:"javascript:;"}},[a("span",{staticClass:"loading-text"},[e._v("正在努力加载")]),e._v(" "),a("i",{staticClass:"loading-spinner spinning"})])}]});